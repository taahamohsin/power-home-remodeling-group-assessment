
<%
  @ticket_escalations_data.map(&:deep_symbolize_keys).each do |stage| %>
    <%= pb_rails("layout/body", props: { classname: 'pb_ticket_escalation_column' }) do %>
      <%= pb_rails("card", props: { padding: "sm", margin_bottom: "none", highlight: { position: "side", color: ticket_highlight_color_class(stage[:name])}, classname: 'category-title-card' }) do %>
        <%= pb_rails("flex", props: { justify: "between" }) do %>
          <%= pb_rails("flex/flex_item") do %>
           <%= pb_rails("caption", props: {text: stage[:name] }) %>
          <% end %>
          <%= pb_rails("flex/flex_item") do %>
            <%= pb_rails("badge", props: {
              text: stage[:count],
              variant: ticket_category_badge_variant(stage[:name])
              })
            %>
          <% end %>
        <% end %>
      <% end %>
      <% stage[:tickets][0, 5].each do |ticket| %>
        <%= pb_rails("card", props: { padding: "xs", margin_top: "none", margin_bottom: "none" }) do %>
          <%= pb_rails("flex", props: { justify: "between", align_items: "center" }) do %>
            <%= pb_rails("flex/flex_item") do %>
              <%= pb_rails("avatar", props: {
                  name: ticket[:user],
                  size: "xs",
                  image_url: image_url(ticket[:avatarUrl] || '')
                }) %>
            <% end %>
          <%= pb_rails("flex/flex_item", props: { flex: 1, padding_left: "xs", classname: 'ticket-title-container'}) do %>
            <%= pb_rails("body", props: { text: ticket[:issue], truncate: "1", size: 4, weight: 'light', max_width: '90px' }) %>
          <% end %>
            <%= pb_rails("flex/flex_item") do %>
              <%= pb_rails("button", props: { variant: "link",  icon: image_url("icons/chevron-right"), icon_right: true, padding_left: "none", padding_right: "xs", classname: 'chevron-right-button', size: "sm" }) %>
            <% end %>
        <% end %>
      <% end %>

  <% end %>
       <% if stage[:tickets].length > 6 %>
        <%= pb_rails("card", props: { padding: "xs", margin_top: "none", justify_content: "center" }) do %>
          <%= pb_rails("button", props: { text: "Show More", variant: "link", size: "sm", full_width: true }) %>
        <% end %>
    <% end %>
  <% end %>
<% end %>

